{% extends "base.html" %}

{% block title %}Manage Database Backups - GenTube Admin{% endblock %}

{% block content %}
<div class="mx-auto max-w-7xl">
    <div class="mb-8 flex flex-wrap items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold tracking-tight text-text-light dark:text-text-dark">Manage Database Backups</h1>
            <p class="mt-2 text-base text-text-light/80 dark:text-text-dark/80">Create, restore, and manage database backups.</p>
        </div>
        <a href="{{ url_for('backup_database') }}" class="flex items-center justify-center rounded-md bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition-opacity hover:opacity-90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">
            <span class="material-symbols-outlined -ml-1 mr-2 text-sm">add</span>
            Create New Backup
        </a>
    </div>
    
    {% if backups %}
    <div class="overflow-hidden rounded-lg border border-border-light bg-surface-light shadow-md dark:border-border-dark dark:bg-surface-dark">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-border-light dark:divide-border-dark">
                <thead class="bg-background-light dark:bg-background-dark">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-light/80 dark:text-text-dark/80" scope="col">Backup File</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-light/80 dark:text-text-dark/80" scope="col">Date Created</th>
                        <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-text-light/80 dark:text-text-dark/80" scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border-light dark:divide-border-dark">
                    {% for backup in backups %}
                    <tr>
                        <td class="whitespace-nowrap px-6 py-4 font-mono text-sm">{{ backup }}</td>
                        <td class="whitespace-nowrap px-6 py-4 text-sm">
                            {% set parts = backup.replace('videos_backup_', '').replace('.db', '').split('_') %}
                            {% if parts|length >= 2 %}
                                {{ parts[0][:4] }}-{{ parts[0][4:6] }}-{{ parts[0][6:8] }} {{ parts[1][:2] }}:{{ parts[1][2:4] }}:{{ parts[1][4:6] }}
                            {% else %}
                                {{ backup }}
                            {% endif %}
                        </td>
                        <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                            <a href="{{ url_for('restore_backup', filename=backup) }}" 
                               onclick="return confirm('Are you sure you want to restore from this backup? This will overwrite the current database!')" 
                               class="inline-flex items-center justify-center rounded-md bg-danger px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-danger/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-danger">
                                <span class="material-symbols-outlined -ml-1 mr-2 text-sm" style="font-variation-settings: 'FILL' 1;">warning</span>
                                Restore
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="rounded-lg border border-info/30 bg-info/10 p-6 dark:bg-info/20">
        <div class="flex items-start gap-4">
            <span class="material-symbols-outlined mt-1 text-info">info</span>
            <div>
                <h3 class="text-lg font-semibold text-text-light dark:text-text-dark">No Backups Found</h3>
                <p class="mt-1 text-sm text-text-light/80 dark:text-text-dark/80">
                    No backups found. <a href="{{ url_for('backup_database') }}" class="text-primary hover:underline">Create your first backup</a>.
                </p>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="mt-8 rounded-lg border border-warning/30 bg-warning/10 p-6 dark:bg-warning/20">
        <div class="flex items-start gap-4">
            <span class="material-symbols-outlined mt-1 text-warning" style="font-variation-settings: 'FILL' 1;">error</span>
            <div>
                <h3 class="text-lg font-semibold text-text-light dark:text-text-dark">Backup System Information</h3>
                <ul class="mt-2 list-inside list-disc space-y-1 text-sm text-text-light/80 dark:text-text-dark/80">
                    <li>Automatic backups are performed daily at 3:00 AM UTC.</li>
                    <li>A maximum of 7 daily backups are retained. Older backups are automatically deleted.</li>
                    <li class="font-semibold text-danger/80 dark:text-danger/90">Warning: Restoring from a backup will overwrite the current database. This action cannot be undone.</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="mt-8 flex justify-start">
        <a href="{{ url_for('dashboard') }}" class="rounded-md bg-surface-light dark:bg-surface-dark px-3.5 py-2.5 text-sm font-semibold text-text-light dark:text-text-dark shadow-sm ring-1 ring-inset ring-border-light dark:ring-border-dark hover:bg-gray-50 dark:hover:bg-surface-dark/60">
            Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}